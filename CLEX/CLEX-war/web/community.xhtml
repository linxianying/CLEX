<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition  xmlns="http://www.w3.org/1999/xhtml"
                 xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                 xmlns:h="http://xmlns.jcp.org/jsf/html"
                 xmlns:f="http://xmlns.jcp.org/jsf/core"
                 template="/WEB-INF/template.xhtml"
                 xmlns:p="http://primefaces.org/ui">

    <ui:define name="title">PRISM Student Community Page</ui:define>

    <ui:define name="viewname">#{bundle['community']}</ui:define>

    <ui:define name="content">
        <p:growl id="messages" showDetail="true"/>        
        <p:tabView id="communityTab">
            <p:tab title="#{bundle['community']} - #{forumListBean.userEntity.school}">
                <p:commandButton icon="fa fa-plus" value="#{bundle['newThread']}" id="newThreadButton" >
                    <p:overlayPanel id="createthreadwidget" for="newThreadButton" showEffect="fade" hideEffect="fade" widgetVar="createThreadWidget">
                        <h:form id="createForm">
                            <h:panelGrid columns="1">
                                <h:panelGrid columns="2">
                                    <h:outputLabel for="tag2" value="Tags: " />
                                    <p:selectOneMenu title="Select a tag from the list (Optional)"
                                                     value="#{forumListBean.tTag}" required="false"
                                                     id="tag" >
                                         <f:selectItem itemLabel="#{bundle['General']}" itemValue="general" />
                                        <f:selectItem itemLabel="#{bundle['Group Formation']}" itemValue="groupformation"  />
                                        <f:selectItem itemLabel="#{bundle['Tutorial Help']}" itemValue="tutorial"  />
                                        <f:selectItem itemLabel="#{bundle['Voluntary Work']}" itemValue="volunteer"  />
                                        <f:selectItem itemLabel="#{bundle['Degree-related']}" itemValue="degree"  />
                                        <f:selectItem itemLabel="#{bundle['Module-related']}" itemValue="module"  />
                                        <f:selectItem itemLabel="#{bundle['study plan']}" itemValue="studyplan"  />
                                        <f:selectItem itemLabel="#{bundle['Teaching Assistant']}" itemValue="searchta" />
                                    </p:selectOneMenu>
                                </h:panelGrid>
                                <br />
                                <p:inputTextarea rows="1" cols="100" title="Title" placeholder="Thread Title" id="title" value="#{forumListBean.tTitle}"/>
                                <br />
                                <p:textEditor widgetVar="editor1" value="#{forumListBean.tContent}" height="300" style="margin-bottom:10px" placeholder="Enter your content">
                                    <f:facet name="toolbar">
                                        <span class="ql-formats">
                                            <span class="ql-formats">
                                                <button class="ql-bold" />
                                                <button class="ql-italic" />
                                                <button class="ql-underline" />
                                                <button class="ql-strike" />
                                            </span>
                                            <span class="ql-formats">
                                                <select class="ql-color" />
                                                <select class="ql-background" />
                                            </span>
                                            <span class="ql-formats">
                                                <button class="ql-script" value="sub" />
                                                <button class="ql-script" value="super" />
                                            </span>
                                            <span class="ql-formats">
                                                <button class="ql-header" value="1" />
                                                <button class="ql-header" value="2" />
                                            </span>                        
                                            <span class="ql-formats">
                                                <button class="ql-clean" />
                                            </span>
                                        </span>    
                                    </f:facet>
                                </p:textEditor>
                                <br />
                                <p:commandButton id="createtthread" icon="fa fa-pencil-square-o" oncomplete="PF('createThreadWidget').hide()" value="Create Thread" actionListener="#{forumListBean.startThread}" update="messages, communityTab:forumForm:forumtable, communityTab:createForm"/>
                            </h:panelGrid>
                        </h:form>
                    </p:overlayPanel>
                </p:commandButton>
                <p:commandButton value="Search" id="searchButton" icon="fa fa-search" >
                    <p:overlayPanel dynamic="true" id="searchthreadwidget" for="searchButton" showEffect="fade" hideEffect="fade" widgetVar="searchWidget">
                        <h:form id="searchForm">
                            <h:panelGrid columns="1">
                                <h:panelGrid columns="2">
                                    <h:outputLabel for="tag2" value="Tags: " />
                                    <p:selectOneMenu title="Select a tag from the list (Optional)"
                                                     value="#{forumListBean.searchTag}" required="false"
                                                     id="tag2" >
                                        <f:selectItem itemLabel="Optional" itemValue=" " />
                                         <f:selectItem itemLabel="#{bundle['General']}" itemValue="general" />
                                        <f:selectItem itemLabel="#{bundle['Group Formation']}" itemValue="groupformation"  />
                                        <f:selectItem itemLabel="#{bundle['Tutorial Help']}" itemValue="tutorial"  />
                                        <f:selectItem itemLabel="#{bundle['Voluntary Work']}" itemValue="volunteer"  />
                                        <f:selectItem itemLabel="#{bundle['Degree-related']}" itemValue="degree"  />
                                        <f:selectItem itemLabel="#{bundle['Module-related']}" itemValue="module"  />
                                        <f:selectItem itemLabel="#{bundle['study plan']}" itemValue="studyplan"  />
                                        <f:selectItem itemLabel="#{bundle['Teaching Assistant']}" itemValue="searchta" />
                                    </p:selectOneMenu>
                                </h:panelGrid>
                                <br />
                                <p:inputTextarea rows="1" cols="50" title="Title" placeholder="Thread Title" id="searchtitle" value="#{forumListBean.searchTitle}"/>                                    
                                <br />
                                <p:inputTextarea rows="5" cols="50" title="Content" placeholder="Thread Content" id="searchcontent" value="#{forumListBean.searchContent}" />

                            </h:panelGrid>
                            <p:spacer/>
                            <br />
                            <p:commandButton id="searchthread" oncomplete="PF('searchWidget').hide()" icon="fa fa-search-plus" value="Search Thread" actionListener="#{forumListBean.searchThread}" update="communityTab:forumForm, messages, communityTab:searchForm"/>
                            <p:commandButton id="clearsearchthread" oncomplete="PF('searchWidget').hide()" icon="fa fa-search-minus" value="Clear Search" actionListener="#{forumListBean.refresh()}" update="communityTab:forumForm, messages, communityTab:searchForm" />

                        </h:form>
                    </p:overlayPanel>
                </p:commandButton>
                <br /><br />
                <h:form id="forumForm">
                    <h:panelGroup>
                        <p:dataTable selectionMode="single" selection="#{forumListBean.selectedThread}" rowKey="#{important.id}"
                                     id="importanttable" value="#{forumListBean.important}" 
                                     var="important" paginator="true" 
                                     rows="15" pageLinks="5" styleClass="paginated" paginatorAlwaysVisible="false" 
                                     emptyMessage="No threads has been stickied yet!">
                            <p:ajax event="rowSelect" listener="#{forumListBean.onRowSelect}" update="messages" />                            
                            <p:column style="height:40px" headerText="Pinned Threads (Includes Module Reviews and Bazaar Corner)" >                                
                                <h:panelGroup>
                                    <h:panelGroup>
                                        <h:outputLabel style="font-size: 16px; font-weight: bold" value="**IMPORTANT** - " rendered="#{important.tag eq 'important'}"/>
                                        <h:outputLabel style="font-size: 16px; font-weight: bold" value="(FAQ) - " rendered="#{important.tag eq 'faq'}"/>
                                        <h:outputLabel style="font-size: 16px; font-weight: bold" value="##RULES## - " rendered="#{important.tag eq 'rules'}"/>
                                    </h:panelGroup>                                    
                                    <h:outputLabel style="font-size: 16px; font-weight: bold" value="#{important.title}"/>
                                </h:panelGroup>
                                <br />
                                <h:outputLabel style="font-size: 11px" value="#{important.user.name} - #{forumListBean.dayTime(important)}" />   
                                <br />
                                <h:outputLabel style="font-size: 11px" value=" Last edited: #{forumListBean.latestReplyDayTime(important.editDateTime)}" rendered="#{important.edited == true}"/> 

                                <h:outputLabel style="font-size: 11px" value=" Last post: #{forumListBean.latestReplyDayTime(important.latestReplyDateTime)}" /> 
                            </p:column>
                            <p:column style="text-align: center;width: 11%;height:40px" headerText="Replies" >
                                <h:outputLabel style="font-size: 16px" value="#{important.replies.size()}"/> 
                            </p:column>
                            <p:column style="text-align: center;width: 11%;height:40px" headerText="Votes" >
                                <h:outputLabel id="positiveThread" style="font-size:16px; font-weight: bold;" value="+#{important.upVote - threads.downVote}" rendered="#{(important.upVote - important.downVote) gt 0}"/>
                                <h:outputLabel id="negativeThead" style="font-size:16px; font-weight: bold;" value="#{important.upVote - threads.downVote}" rendered="#{(important.upVote - important.downVote) lt 0}"/>
                                <h:outputLabel id="zeroThread" style="font-size:16px; font-weight: bold;" value="0" rendered="#{(important.upVote - important.downVote) == 0}"/>
                            </p:column>
                        </p:dataTable>
                    </h:panelGroup>
                    <h:panelGroup>
                        <p:dataTable selectionMode="single" selection="#{forumListBean.selectedThread}" rowKey="#{threads.id}"
                                     id="forumtable" value="#{forumListBean.threads}" 
                                     var="threads" paginator="true" 
                                     rows="15" pageLinks="5" styleClass="paginated" paginatorAlwaysVisible="false" 
                                     emptyMessage="No threads has been created yet!">
                            <p:ajax event="rowSelect" listener="#{forumListBean.onRowSelect}" update="messages" />                            
                            <p:column style="height:40px" headerText="Thread / Thread Starter" >                                
                                <h:outputLabel style="font-size: 16px" value="#{threads.title}"/>
                                <br />
                                <h:outputLabel style="font-size: 11px" value="#{threads.user.name} - #{forumListBean.dayTime(threads)}" />   
                                <br />
                                <h:outputLabel style="font-size: 11px" value=" Last post: #{forumListBean.latestReplyDayTime(threads.latestReplyDateTime)}" /> 
                            </p:column>
                            <p:column style="text-align: center;width: 11%;height:40px" headerText="Replies" >
                                <h:outputLabel style="font-size: 16px" value="#{threads.replies.size()}"/> 
                            </p:column>
                            <p:column style="text-align: center;width: 11%;height:40px" headerText="Votes" >
                                <h:outputLabel id="positiveThread" style="font-size:16px; font-weight: bold;" value="+#{threads.upVote - threads.downVote}" rendered="#{(threads.upVote - threads.downVote) gt 0}"/>
                                <h:outputLabel id="negativeThead" style="font-size:16px; font-weight: bold;" value="#{threads.upVote - threads.downVote}" rendered="#{(threads.upVote - threads.downVote) lt 0}"/>
                                <h:outputLabel id="zeroThread" style="font-size:16px; font-weight: bold;" value="0" rendered="#{(threads.upVote - threads.downVote) == 0}"/>
                            </p:column>
                        </p:dataTable>
                    </h:panelGroup>
                </h:form>
                <br /><br />
            </p:tab>

            <p:tab title="#{forumListBean.userEntity.school} MODULE REVIEWS">
                <p:commandButton value="Search Module Code" id="searchButton2" icon="fa fa-search" >
                    <p:overlayPanel id="searchreviewwidget" for="searchButton2" showEffect="fade" hideEffect="fade" widgetVar="searchWidget2"  style="width: 300px; height: 333px">
                        <h:form id="searchForm2">
                            <h:panelGrid columns="1">
                                <p:outputLabel id="viewLabel" for="moduleCode" value="Module Code:" />
                                <p:selectOneMenu id="moduleCode" value="#{forumListBean.searchModuleCode}"  panelStyle="width:180px" effect="fade" 
                                                 var="course" style="width:160px" filter="true" filterMatchMode="contains" appendTo="@this">
                                    <!--p:ajax event="change" listener="#{forumListBean.searchReview()}" update="communityTab:forumForm2, messages, communityTab:searchForm2"  /-->
                                    <f:selectItem itemLabel="Select One" itemValue="select"/>
                                    <f:selectItems value="#{forumListBean.courses}" var="course" itemLabel="#{course.moduleCode}" itemValue="#{course.moduleCode}" />
                                </p:selectOneMenu>                                 
                                <h:panelGroup>
                                    <p:commandButton id="searchreview" oncomplete="PF('searchWidget2').hide()" icon="fa fa-search" value="Search Review" actionListener="#{forumListBean.searchReview}" update="communityTab:forumForm2, messages, communityTab:searchForm2"/>
                                    <p:commandButton id="clearsearchreview" oncomplete="PF('searchWidget2').hide()" icon="fa fa-search-minus" value="Clear Search" actionListener="#{forumListBean.refresh()}" update="communityTab:forumForm2, messages, communityTab:searchForm2" />
                                </h:panelGroup>
                            </h:panelGrid>
                        </h:form>
                    </p:overlayPanel>
                </p:commandButton>
                <br /><br />
                <h:form id="forumForm2">
                    <h:panelGroup>
                        <p:dataTable selectionMode="single" selection="#{forumListBean.selectedThread}" rowKey="#{threads.id}"
                                     id="forumtable" value="#{forumListBean.reviewThreads}" 
                                     var="threads" paginator="true" 
                                     rows="15" pageLinks="5" styleClass="paginated" paginatorAlwaysVisible="false" 
                                     emptyMessage="No reviews has been created yet!">
                            <p:ajax event="rowSelect" listener="#{forumListBean.onRowSelect}" update="messages" />                            
                            <p:column style="height:40px" headerText="Review" >                                
                                <h:outputLabel style="font-size: 16px" value="#{threads.title}"/>
                                <br />
                                <h:outputLabel style="font-size: 11px" value="#{threads.user.name} - #{forumListBean.dayTime(threads)}" />   
                                <br />
                                <h:outputLabel style="font-size: 11px" value=" Last post: #{forumListBean.latestReplyDayTime(threads.latestReplyDateTime)}" /> 
                            </p:column>
                            <p:column style="text-align: center;width: 11%;height:40px" headerText="Replies" >
                                <h:outputLabel style="font-size: 16px" value="#{threads.replies.size()}"/> 
                            </p:column>
                            <p:column style="text-align: center;width: 11%;height:40px" headerText="Votes" >
                                <h:outputLabel id="positiveThread" style="font-size:16px; font-weight: bold" value="+#{threads.upVote - threads.downVote}" rendered="#{(threads.upVote - threads.downVote) gt 0}"/>
                                <h:outputLabel id="negativeThead" style="font-size:16px; font-weight: bold;" value="#{threads.upVote - threads.downVote}" rendered="#{(threads.upVote - threads.downVote) lt 0}"/>
                                <h:outputLabel id="zeroThread" style="font-size:16px; font-weight: bold;" value="0" rendered="#{(threads.upVote - threads.downVote) == 0}"/>
                            </p:column>
                        </p:dataTable>
                    </h:panelGroup>
                </h:form>
                <br /><br />
            </p:tab>
            <p:tab title="BAZAAR CORNER - #{forumListBean.userEntity.school}">
                <p:commandButton icon="fa fa-plus" value="Buy/Sell" id="newSalesButton" >
                    <p:overlayPanel id="createsaleswidget" for="newSalesButton" showEffect="fade" hideEffect="fade" widgetVar="createSalesWidget">
                        <h:form id="salesForm">
                            <h:panelGrid columns="1">     
                                <p:selectOneRadio id="buysell" value="#{forumListBean.buysell}" >
                                    <p:ajax update="salegroup" event="change" />
                                    <f:selectItem itemLabel="Sell" itemValue="sell" />
                                    <f:selectItem itemLabel="Buy" itemValue="buy" />
                                </p:selectOneRadio>
                                <!--<p:inputTextarea rows="1" cols="100" title="Title" placeholder="Thread Title" id="title2" value="#{forumListBean.tTitle}"/>-->
                                <h:panelGrid columns="4" id="salegroup">
                                    <h:panelGroup >
                                        <h:outputText value="Item for sale: " rendered="#{forumListBean.buysell == 'sell'}"/>
                                        <h:outputText value="Looking for: " rendered="#{forumListBean.buysell == 'buy'}"/>
                                    </h:panelGroup>
                                    <p:inputText value="#{forumListBean.bazaaritem}" required="true" requiredMessage="Please enter an item name"/>
                                    <h:outputText value="Price (SGD$): "/>
                                    <p:inputNumber minValue="0.01" value="#{forumListBean.bazaarprice}" required="true" requiredMessage="Please enter a price"/>
                                    <h:outputText value="Condition: "/>
                                    <p:selectOneRadio id="condition" value="#{forumListBean.bazaarcondition}" required="true">
                                        <f:selectItem itemLabel="Brand New" itemValue="Brand New" />
                                        <f:selectItem itemLabel="Like New" itemValue="Like New" />
                                        <f:selectItem itemLabel="Used" itemValue="Used" />
                                    </p:selectOneRadio>
                                </h:panelGrid>
                                <p:textEditor id="content2" widgetVar="editor2" value="#{forumListBean.tContent}" height="150" style="margin-bottom:10px" placeholder="Other details about the Item">
                                    <f:facet name="toolbar">
                                        <span class="ql-formats">
                                            <span class="ql-formats">
                                                <button class="ql-bold" />
                                                <button class="ql-italic" />
                                                <button class="ql-underline" />
                                                <button class="ql-strike" />
                                            </span>
                                            <span class="ql-formats">
                                                <select class="ql-color" />
                                                <select class="ql-background" />
                                            </span>
                                            <span class="ql-formats">
                                                <button class="ql-script" value="sub" />
                                                <button class="ql-script" value="super" />
                                            </span>
                                            <span class="ql-formats">
                                                <button class="ql-header" value="1" />
                                                <button class="ql-header" value="2" />
                                            </span>                        
                                            <span class="ql-formats">
                                                <button class="ql-clean" />
                                            </span>
                                        </span>    
                                    </f:facet>
                                </p:textEditor>

                                <p:commandButton id="createsales" icon="fa fa-dollar" oncomplete="PF('createSalesWidget').hide()" value="Create Thread" actionListener="#{forumListBean.startSales}" update="messages, communityTab:salesForum:salestable, communityTab:salesForm"/>
                            </h:panelGrid>
                        </h:form>
                    </p:overlayPanel>
                </p:commandButton>
                <p:commandButton value="Search" id="searchButton3" icon="fa fa-search" >
                    <p:overlayPanel for="searchButton3" showEffect="fade" hideEffect="fade" widgetVar="searchWidget3">
                        <h:form id="searchForm3">
                            <h:panelGrid columns="1">
                                <p:selectOneRadio id="buysell2" value="#{forumListBean.buysell}">
                                    <f:selectItem itemLabel="Sell" itemValue="sell" />
                                    <f:selectItem itemLabel="Buy" itemValue="buy" />
                                </p:selectOneRadio>
                                <p:inputTextarea rows="1" cols="50" title="Title" placeholder="Sales Title (Optional)" id="searchtitle3" value="#{forumListBean.searchTitle}"/>                                    
                                <p:inputTextarea rows="5" cols="50" title="Content" placeholder="Sales Content (Optional)" id="searchcontent3" value="#{forumListBean.searchContent}" />
                                <h:panelGroup>
                                    <p:commandButton id="searchsales" oncomplete="PF('searchWidget3').hide()" icon="fa fa-search" value="Sales" actionListener="#{forumListBean.searchSales}" update="communityTab:salesForum, messages, communityTab:searchForm3"/>
                                    <p:commandButton id="clearsearchsales" oncomplete="PF('searchWidget3').hide()" icon="fa fa-search-minus" value="Clear" actionListener="#{forumListBean.refresh()}" update="communityTab:salesForum, messages, communityTab:searchForm3" />
                                </h:panelGroup>
                            </h:panelGrid>
                        </h:form>
                    </p:overlayPanel>
                </p:commandButton>
                <br /><br />
                <h:form id="salesForum">
                    <h:panelGroup>
                        <p:dataTable selectionMode="single" selection="#{forumListBean.selectedThread}" rowKey="#{sales.id}"
                                     id="salestable" value="#{forumListBean.bazaar}" 
                                     var="sales" paginator="true" 
                                     rows="15" pageLinks="5" styleClass="paginated" paginatorAlwaysVisible="false" 
                                     emptyMessage="No bargains has been made yet!">
                            <p:ajax event="rowSelect" listener="#{forumListBean.onRowSelect}" update="messages" />                            
                            <p:column style="height:40px" headerText="Thread / Thread Starter" >                                
                                <h:outputLabel style="font-size: 16px" value="#{sales.title}"/>
                                <br />
                                <h:outputLabel style="font-size: 11px" value="#{sales.user.name} - #{forumListBean.dayTime(sales)}" />   
                                <br />
                                <h:outputLabel style="font-size: 11px" value=" Last post: #{forumListBean.latestReplyDayTime(sales.latestReplyDateTime)}" /> 
                            </p:column>
                            <p:column style="text-align: center;width: 11%;height:40px" headerText="Replies" >
                                <h:outputLabel style="font-size: 16px" value="#{sales.replies.size()}"/> 
                            </p:column>

                        </p:dataTable>
                    </h:panelGroup>
                </h:form>
                <br /><br />
            </p:tab>

        </p:tabView>
    </ui:define>
</ui:composition>

